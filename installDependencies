#installing dependencies
#this doesnt work properly needs multi threaded for the spinner
import subprocess, sys, time, itertools
from os import system

#packages should be entered in string format. # e.g "PyMuPDF"
packages = {"PyMuPDF":"fitz"}

#quick fake spinner
spinner = itertools.cycle("▖▘▝▗")

def permission(packages = packages):

    answer = input(f"The Script will now attempt to install the following libraries {packages}! Do you wish to continue? [Y/N]").strip().upper()
    system('cls')
    match answer:
        case "N":
            sys.exit()
        case "Y":
            return 0
        case _:
            print("Please answer either Y or N")
            return permission(packages)
    

def installDependencies(packages = packages, spinner = spinner):

    for pipCommand, importCommand in packages.items():
        try:
            print(f"testing import {pipCommand}...", flush=True)
            #i could while loops this but will require multi threads and honestly faking it is enough.
            for _ in range(5):
                time.sleep(0.5)
                print(f"\rImporting {pipCommand} {next(spinner)}", end="", flush=True)
            __import__(importCommand)
        except ImportError:
            print(f"\nInstalling required package: {pipCommand} please standby...")
            subprocess.check_call([sys.executable, "-m", "pip", "install", pipCommand])
    system('cls')
    print("Packages installed.")

def main():
    permission()
    installDependencies()

if __name__ == "__main__":
    main()